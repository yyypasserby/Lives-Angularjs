<script type="text/javascript">  
function previewImage(file)  
{  
  var MAXWIDTH  = 120;  
  var MAXHEIGHT = 120;  
  var div = document.getElementById('preview');  
  if (file.files && file.files[0])  
  {  
    div.innerHTML = '<img id=imghead>';  
    var img = document.getElementById('imghead');
    var road = document.getElementById('textfield');  
    img.onload = function(){  
      var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);  
      img.width = rect.width;  
      img.height = rect.height;  
      img.style.marginLeft = rect.left+'px';  
      img.style.marginTop = rect.top+'px';  
    }  
    var reader = new FileReader();  
    reader.onload = function(evt){img.src = evt.target.result;}  
    reader.readAsDataURL(file.files[0]);  
  }  
  else  
  {  
    var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'; 
    file.select();  
    var src = document.selection.createRange().text;  
    div.innerHTML = '<img id=imghead>';  
    var img = document.getElementById('imghead');  
    img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;  
    var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);  
    status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);  
    div.innerHTML = "<div id=divhead style='width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;margin-left:"+rect.left+"px;"+sFilter+src+"\"'></div>";  
  }  
}  
function clacImgZoomParam( maxWidth, maxHeight, width, height ){  
    var param = {top:0, left:0, width:width, height:height}; 
    if(width<maxWidth){param.width = maxWidth;}
    if(height<maxHeight){param.height = maxHeight;}  
    if( width>maxWidth || height>maxHeight )  
    {  
        rateWidth = width / maxWidth;  
        rateHeight = height / maxHeight;  
          
        if( rateWidth > rateHeight )  
        {  
            param.width =  maxWidth;  
            param.height = Math.round(height / rateWidth);  
        }else  
        {  
            param.width = Math.round(width / rateHeight);  
            param.height = maxHeight;  
        }  
    }  
      
    param.left = Math.round((maxWidth - param.width) / 2);  
    param.top = Math.round((maxHeight - param.height) / 2);  
    return param;  
}  
</script>

<script>
function thisMovie(movieName) {
    if (navigator.appName.indexOf("Microsoft") != -1) {
        return window[movieName];
    } else {
        //alert(document[movieName]);
        return document[movieName];
    }
}
function applyFsoHandler(){
    applyFso("hashValue")
}
function applyFso(hashValue){
    thisMovie("applyComp").getHashFromJs(hashValue);
}
function replyer(){
    alert("success");
}
</script>
<script type="text/ng-template" id="UserSettings.html">
<div class="modal-header">
        <h3 class="modal-title">User Settings</h3>
    </div>
    <div class="modal-body">
        <div class="thumbnail media">
            <div class="pull-left" id="preview">  
                <img id="imghead" width=120 height=120 border=0 src="images/yeoman.png">  
            </div>
            <div class="media-body" style="height:120px;overflow:hidden;">
                <input type="button" class='btn btn-primary' style="width:180px;position:relative;top:30px;" value='Upload headImage'>
                <input type="text" name='textfield' id='textfield' class='txt' style="margin-top:40px;">                       
                <input type="file" class="file" value="Upload headImage" style="position:relative;bottom:80px;opacity:0;height:30px;width:220px;cursor:pointer;" onchange="previewImage(this);document.getElementById('textfield').value=this.value">
            </div>
        </div>
        <dl class="dl-horizontal">
            <dt class="lead" style="margin-bottom:0px">Username</dt>
            <dd><input type="text" placeholder="{{settings.username}}"></input></dd>
            <dt class="lead">Email</dt>
            <dd><input type="email" placeholder="{{ settings.email }}"></input></dd>
        </dl>
    </div>
    <div class="modal-footer" style="background-color:#d3ecf5;">
        <button class="btn btn-primary" ng-click="ok()">OK</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>

<script type="text/ng-template" id="UserFavor.html">
    <div class="modal-header">
        <h3 class="modal-title">您想看点什么呢？</h3>
    </div>
    <div class="modal-body">
        <div class="thumbnail media span3" id="favor" style="margin-top:0px;" ng-repeat="tag in tags" ng-click="addFavor(tag)">
            <a class="pull-left" >
                <img class="media-object" style="width:100px;height:100px"ng-src="images/cata_small/{{ tag.thumbnailSmall }}"></img>
            </a>
            <div class="media-body">
                <h4 class="media-heading">{{ tag.tagName }}</h4>
                <span class="label">{{ tag.tagAttention }}人关注</span>
                <div class="pull-right" style="margin-top:20px;" ng-show="tag.selected">
                    <i class="icon-ok" style="margin-right:10px;"></i>已关注
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer" style="background-color:#d3ecf5;">
        <button class="btn btn-primary" ng-click="ok()">确认</button>
        <button class="btn btn-warning" ng-click="cancel()">取消</button>
    </div>
</script>

<script type="text/ng-template" id="CastInfo.html">
    <div class="modal-header">
        <h3 class="modal-title">你的主播信息</h3>
    </div>
    <div class="modal-body">
         <dl class="dl-horizontal">
            <dt class="lead" style="margin-bottom:0px">RTMP地址</dt>
            <dd>
            <input class="disable" type="text" placeholder="" value="{{rtmp}}"></input>
            <a class="btn btn-warning" style="margin-left:10px;margin-bottom:10px">复制</a>
            </dd>
            <dt class="lead" style="margin-bottom:0px">Stream名称</dt>
            <dd>
            <input type="text" placeholder="" value="{{streamName}}"></input>
            <a class="btn btn-warning" style="margin-left:10px;margin-bottom:10px">复制</a>
            </dd>
            <dt class="lead" style="margin-bottom:0px">视频名称</dt>
            <dd>
            <input type="text" placeholder="" ng-model="livename"></input>
            </dd>
            <dt class="lead">视频分类</dt>
            <dd>
            <input type="text" placeholder="" ng-model="tag"></input>
            </dd>

        </dl>
    </div>
    <div class="modal-footer" style="background-color:#d3ecf5;">
        <button class="btn btn-primary" ng-click="ok()">确认</button>
    </div>
</script>


<div class="container container-fluid" style="margin-top:20px;" ng-show="showPage">
    <div class="row-fluid">
        <div class="span8">
            <div class="thumbnail media message" >
                <div class="pull-left span2" style="margin:10px;">
                    <img class="media-object img-rounded" ng-src="images/caster/{{ message.user.thumbnail }}"></img>
                    <p class="text-center" style="font-size:24px">
                        {{ message.user.username }}
                    </p>
                </div>
                <div class="media-body" style="margin-left:100px;">
                    <h3 class="media-heading">{{ message.caster.username }}的直播间</h3>
                    <div class="media" style="margin-top:0px;">
                        <div class="pull-left">
                            <a href="#/castroom/{{ message.caster.username }}">
                                <img class="liveThumbnail swap2 img-rounded" ng-src="images/utils/play.png"></img>
                                <img class="img-rounded liveThumbnail" ng-src="images/lives/{{ message.video.thumbnail }}"></img>
                            </a>
                        </div>
                        <div class="media-body">
                            <h4 class="media-heading">{{ message.video.livename }}</h3>
                            <div>
                            <h5 class="muted">{{ message.user.username }}正在看</h5>
                            <div class="muted"><i class="icon-fire"></i> {{ message.caster.hotRate}}</div>
                            <div class="muted"><i class="icon-eye-open"></i> {{ message.caster.attention}}</div>
                            <span class="muted"></span>
                            </div>
                        </div>
                        <p style="position:absolute;bottom:10px;right:20px;">
                        <span class="label label-warning label-bigger">
                            {{ message.time }} {{ message.status }}
                        </span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="span4">
            <div class="thumbnail">
            <div class="media" style="padding:20px;padding-top:0px">
                <img class="pull-left" ng-src="images/caster/{{ user.thumbnail }}" style="width:40%;margin-top:10px;">
                <div class="media-body">
                    <h4>{{ user.username }}</h4>
                    <p>
                    {{ user.email }}
                    </p>
                    <button class="btn btn-primary" ng-click="openUserSettings()">
                        修改资料
                    </button>
                </div>
                <div>
                    <a class="btn btn-large btn-success btn-block" ng-click="OpenCastInfoDialog()" style="margin-top:30px;">我要直播</a>
                    <span display="none">
                    <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
                        id="applyComp" width="0" height="0"
                        codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" style="float:left">
                        <param name="movie" value="apply.swf?id=<?php echo(rand());?>" />
                        <param name="quality" value="high" />
                        <param name="bgcolor" value="#fff" />
                        <param name="allowScriptAccess" value="sameDomain" />
                        <embed src="flash/apply.swf?id=<?php echo(rand());?>
                            &theStreamName=mp4:shortd.flv
                            &serverUrl=rtmfp://223.3.91.16/LivesServer" 
                            quality="high" bgcolor="#fff"
                            width="0" height="0" name="applyComp" align="middle"
                            play="true" loop="false" quality="high" allowScriptAccess="sameDomain"
                            type="application/x-shockwave-flash"
                            allowFullScreen="true"
                            pluginspage="http://www.macromedia.com/go/getflashplayer">
                        </embed>
                    </object>
                    </span>
                </div>
                <hr></hr>
                <div style="">
                    <span class="label label-bigger" style="margin-right:10px;margin-bottom:10px;" ng-repeat="tag in tags | filter : {selected : true}">{{ tag.tagName }}</span>
                    <div id="add" ng-click="openUserFavor()">
                        <span id="plus" style="line-height:25px;">+</span>
                    </div>
                </div>
            </div>
        </div>
        <hr></hr>
        <div class="thumbnail">
            <div class="media img-rounded" id="friend_box" style="" ng-repeat="friend in friends">
                <a class="pull-left">
                    <img class="media-object people-head" ng-src="images/caster/{{ friend.thumbnail }}">
                    </img>
                </a>
                <div class="media-body" style="padding:5px">
                    <h4 class="media-heading">{{ friend.username }}</h4>
                    <p>
                    <span class="label" style="">music</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
</div>


