<script type="text/javascript">  
function previewImage(file)  
{  
  var MAXWIDTH  = 120;  
  var MAXHEIGHT = 120;  
  var div = document.getElementById('preview');  
  if (file.files && file.files[0])  
  {  
    div.innerHTML = '<img id=imghead>';  
    var img = document.getElementById('imghead');
    var road = document.getElementById('textfield');  
    img.onload = function(){  
      var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);  
      img.width = rect.width;  
      img.height = rect.height;  
      img.style.marginLeft = rect.left+'px';  
      img.style.marginTop = rect.top+'px';  
    }  
    var reader = new FileReader();  
    reader.onload = function(evt){img.src = evt.target.result;}  
    reader.readAsDataURL(file.files[0]);  
  }  
  else  
  {  
    var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'; 
    file.select();  
    var src = document.selection.createRange().text;  
    div.innerHTML = '<img id=imghead>';  
    var img = document.getElementById('imghead');  
    img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;  
    var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);  
    status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);  
    div.innerHTML = "<div id=divhead style='width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;margin-left:"+rect.left+"px;"+sFilter+src+"\"'></div>";  
  }  
}  
function clacImgZoomParam( maxWidth, maxHeight, width, height ){  
    var param = {top:0, left:0, width:width, height:height};  
    if( width>maxWidth || height>maxHeight )  
    {  
        rateWidth = width / maxWidth;  
        rateHeight = height / maxHeight;  
          
        if( rateWidth > rateHeight )  
        {  
            param.width =  maxWidth;  
            param.height = Math.round(height / rateWidth);  
        }else  
        {  
            param.width = Math.round(width / rateHeight);  
            param.height = maxHeight;  
        }  
    }  
      
    param.left = Math.round((maxWidth - param.width) / 2);  
    param.top = Math.round((maxHeight - param.height) / 2);  
    return param;  
}  
</script>


<script type="text/ng-template" id="UserSettings.html">
    <div class="modal-header">
        <h3 class="modal-title">User Settings</h3>
    </div>
    <div class="modal-body">
        <div class="thumbnail media">
            <div class="pull-left" id="preview">  
                <img id="imghead" width=120 height=120 border=0 src="images/yeoman.png">  
            </div>
            <div class="media-body">
                <input type="button" class='btn btn-primary' style="width:180px;" value='Upload headImage'>
                </br></br>
                <input type="text" name='textfield' id='textfield' class='txt'>                       
                <input type="file" class="file" value="Upload headImage" style="position:relative;bottom:90px;opacity:0;height:30px;width:200px;" onchange="previewImage(this);document.getElementById('textfield').value=this.value">
            </div>
        </div>
        <dl class="dl-horizontal">
            <dt class="lead" style="margin-bottom:0px">Username</dt>
            <dd><input type="text" placeholder="{{settings.username}}"></input></dd>
            <dt class="lead">Email</dt>
            <dd><input type="email" placeholder="{{ settings.email }}"></input></dd>
        </dl>
    </div>
    <div class="modal-footer" style="background-color:#d3ecf5;">
        <button class="btn btn-primary" ng-click="ok()">OK</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>

<script type="text/ng-template" id="UserFavor.html">
    <div class="modal-header">
        <h3 class="modal-title">User Favor</h3>
    </div>
    <div class="modal-body">
        <div class="thumbnail media span3" id="favor" style="margin-top:0px;" ng-repeat="tag in tags" ng-click="addFavor(tag.tagId)">
            <a class="pull-left" >
                <img class="media-object" ng-src="images/dudu.png"></img>
            </a>
            <div class="media-body">
                <h4 class="media-heading">{{ tag.tagName }}</h4>
                <span class="label">15万关注</span>
                <div class="pull-right" style="margin-top:20px;" ng-show="tag.selected">
                    <i class="icon-ok" style="margin-right:10px;"></i>已关注
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer" style="background-color:#d3ecf5;">
        <button class="btn btn-primary" ng-click="ok()">OK</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>

<div class="container container-fluid" style="margin-top:20px;" ng-show="showPage">
    <div class="row-fluid">
        <div class="span8">
            <div class="thumbnail media message" ng-repeat="message in messages">
                <div class="pull-left span2" style="margin:20px; margin-top:80px;">
                    <img class="media-object img-rounded" ng-src="images/{{ message.username }}.png"></img>
                    <h5 class="">{{ message.username }}</h5>
                </div>
                <div class="media-body" style="margin-left:50px;">
                    <h3 class="media-heading">{{ message.heading }}</h3>
                    <img class="img-rounded" style="width:450px;height:280px;" ng-src="images/{{ message.thumbnail }}.jpg"></img>
                    <p class="text-right" style="margin-top:10px;">
                    <span class="label label-warning label-bigger" style="">{{ message.castTime }} {{ message.status }}</span>
                    </p>
                </div>
            </div>
        </div>

        <div class="span4">
            <div class="thumbnail">
            <div class="media" style="padding:20px;padding-top:0px">
                <img class="pull-left" ng-src="images/{{ user.username }}.png" style="width:40%;margin-top:10px;">
                <div class="media-body">
                    <h4>{{ user.username }}</h4>
                    <p>
                    {{ user.email }}
                    </p>
                    <button class="btn btn-primary" ng-click="openUserSettings()">
                        personal center
                    </button>
                </div>
                <hr></hr>
                <div style="">
                    <span class="label label-bigger" style="margin-right:10px;margin-bottom:10px;" ng-repeat="tag in tags | filter : {selected : true}">{{ tag.tagName }}</span>
                <div>
                    <button class="btn btn-primary" ng-click="openUserFavor()">
                        +
                    </button>
                </div>
                </div>
            </div>
        </div>
        <div id="divfloat">
        <div id="floatbox">
        <hr></hr>
        <div class="thumbnail">
            <div class="media img-rounded" id="friend_box" style="" ng-repeat="friend in friends">
                <a class="pull-left">
                    <img class="media-object people-head" ng-src="images/{{ friend.username }}.png">
                    </img>
                </a>
                <div class="media-body" style="padding:5px">
                    <h4 class="media-heading">{{ friend.username }}</h4>
                    <p>
                    <span class="label" style="">music</span>
                    </p>
                </div>
            </div>
        </div>
        </div>
        </div>
    </div>
</div>
</div>
<script>
    $(document).ready(function() {   
        var a = $('#floatbox').offset();   
        $(window).scroll(function() {   
            var b = $(window).scrollTop();   
            if (b > a.top + 5) {   
                $('#divfloat').addClass('fixed');
            } else {   
                $('#divfloat').removeClass('fixed');
            }   
        });   
    });  
</script>

